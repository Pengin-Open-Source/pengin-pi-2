{% load macros %}
{% loadmacros "macros/pagination.html" %}
{% macro render_comments comments current_user is_edited %}
  {% for comment in comments %}
  <tr><td>
    <div class="comment-title-underline">
    <div> by {{comment.author.name|escape}} at {{comment.date|escape}}</div>
    {% if comment.row_action == 'CREATE' %} 
    {% elif comment.row_action == 'EDIT' %}
     <i> (Edited) </i> 
            {% if comment.is_create_missing %}
            <p style="color: red;" >  
              <i> Comment Creation Date / Original Author not found!</i>
            </p>
            {% else %}
                 <div> Originally posted by {{comment.original_author |escape}} at {{comment.create_date|escape}}</div>
            {% endif %}
    {% else %}
          <p style="color: red;" >  
            <i> Warning: This may be a restored comment's date of deletion. Notify your system administrator</i>
          </p>
    {% endif %} 
        
        {% if current_user.is_authenticated %}
          <div class="text-buttons-container">
            {% if user == comment.author or is_admin %}
              <form class="delete-form" method="post" action="{% url 'delete_comment' comment.id  %}">
                {% csrf_token %}
                <button class="text-button" type="submit" onclick="return confirm('Are you sure you want to delete this comment?')">Delete Comment</button>
              </form> 
              <span class="text-button">|</span>
            {% endif %}
            {% if user == comment.author or is_admin  %}
              <a class="text-button" href="{% url 'edit_comment' comment.post.thread.id comment.post.id comment.id %}">Edit Comment</a>
            {% endif %}
          </div>
        {% endif %}
    </div>
    <p>{{comment.content}}</p>
  </td></tr>
  {% endfor %}
  {% use_macro render_pagination comments %}
{% endmacro %}