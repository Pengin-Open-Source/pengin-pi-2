{% extends "layout/fullPageScroll.html" %}
{% load static %}  {# Load static files #}
{% load macros %}
{% loadmacros "macros/pagination.html" %}

{% block pageDropDowns %}
  <a href="{% url 'display_company_info' pk=company.id %}">Company Home</a>
{% endblock %}

{% block pageContent %}
  <div class="content-section">
    <h1 class="profile-title">Edit Company Members</h1>
    <form class="form" id="memberForm" method="POST" action="{% url 'edit_company_members' pk=company.id %}">
      {% csrf_token %}
      <input type="hidden" name="page-number" value="{{ page_obj.number }}"/>
      <div class="member-grid">
        {% for user in users %}
          <div>
            <input type="checkbox" id="{{ user.id }}" name="member-checkbox" value="{{ user.id }}"
                   {% if user.id in member_uid_list %} checked {% endif %} />
            <label for="{{ user.id }}">{{ user.name }}</label>
          </div>
        {% endfor %}
      </div>
      <button class="primary-button" type="submit">Save</button>
    </form>
    {% use_macro render_pagination page_obj %}
{% comment %} 
    {% for object in object_list %}
    <form method="post">
        {% csrf_token %}
        <input type="checkbox" name="select" value="{{ object.id }}" {% if object.id in selected_ids %}checked{% endif %}>
        <input type="hidden" name="deselect" value="{{ object.id }}">
        <label>{{ object }}</label>
        <button type="submit">Update</button>
    </form>
{% endfor %}
    <form class = "form">
    <div>
      {% for id in selected_ids %}
        {{ id }}
      {% endfor %}
    </div>
  </div>
   </form> {% endcomment %}
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
   <script type="text/javascript">

    const checkedValues = [];
    const formData = new FormData(document.getElementById('memberForm'));

    const checkboxes = document.querySelectorAll('input[name="member-checkbox"]');
    const navigationLink = document.getElementById('navigate-next');


    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
          checkedValues.push(checkbox.value);
        }
      ;
    });
    
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          checkedValues.push(checkbox.value);
        } else {
          checkedValues.splice(checkedValues.indexOf(checkbox.value), 1);
        }
      });
    });

    function myJavaScriptFunction(page_number) {
      confirm(page_number)
      const stringifiedValues = JSON.stringify(checkedValues);
      confirm(stringifiedValues)
      fetch('{% url 'edit_company_members' pk=company.id %}?page=' + page_number + '&checked_values=' + encodeURIComponent(stringifiedValues), {
        method: 'GET'});
    }

   </script>


{% endblock %}



